{% extends 'base.html' %}

{% block title %}Brand Voice Codifier - Results{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header card-header-feature">
                <h2 class="h4 mb-0"><i class="fas fa-chart-bar me-2"></i> Brand Voice Parameters</h2>
            </div>
            <div class="card-body">
                <p class="lead">Here are the brand voice parameters we've identified based on your input. As you complete more input methods, your brand voice profile becomes more nuanced and comprehensive.</p>

                <!-- Debug information -->
                <div class="card bg-dark text-white mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Debug Information</h5>
                    </div>
                    <div class="card-body">
                        <h6>Personality Traits:</h6>
                        <p>Primary: {{ brand_parameters.personality.primary_traits|join(', ') }}</p>
                        <p>Secondary: {{ brand_parameters.personality.secondary_traits|join(', ') }}</p>

                        <h6>Emotional Tone:</h6>
                        <p>Primary: {{ brand_parameters.emotional_tone.primary_emotions|join(', ') }}</p>
                        <p>Secondary: {{ brand_parameters.emotional_tone.secondary_emotions|join(', ') }}</p>

                        <h6>Communication Style:</h6>
                        <p>Storytelling: {{ brand_parameters.communication_style.storytelling_preference }}</p>
                        <p>Length: {{ brand_parameters.communication_style.sentence_structure.length_preference }}</p>
                        <p>Complexity: {{ brand_parameters.communication_style.sentence_structure.complexity_preference }}</p>
                    </div>
                </div>

                <div class="alert alert-info mb-4">
                    <div class="d-flex">
                        <div class="me-3">
                            <i class="fas fa-info-circle fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="alert-heading">Combined Analysis</h5>
                            <p>Your brand voice profile is built from all the input methods you've completed. Each method adds nuance to the overall analysis, creating a more comprehensive understanding of your brand voice.</p>
                            <p class="mb-0">Look for the source indicators <i class="fas fa-file-alt" title="Document Upload"></i> <i class="fas fa-comments" title="Brand Interview"></i> <i class="fas fa-globe" title="Web Scraper"></i> next to each parameter to see which input methods contributed to that insight.</p>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="info-card">
                            <div class="card-body">
                                <h5><i class="fas fa-check-circle me-2"></i> Input Methods Used</h5>
                                <ul class="list-group list-group-flush bg-transparent">
                                    <li class="list-group-item bg-card">
                                        <i class="fas {% if input_methods.document_upload.used %}fa-check-circle{% else %}fa-times-circle text-muted{% endif %} me-2"></i>
                                        <span class="text-primary">Document Upload</span>
                                        {% if input_methods.document_upload.used %}
                                            <div>
                                                <span class="badge bg-success ms-2">Doc Analysis Complete</span>
                                                {% if input_methods.document_upload.timestamp %}
                                                    <small class="text-muted d-block mt-1">{{ input_methods.document_upload.timestamp }}</small>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <a href="{{ url_for('document_upload') }}" class="badge bg-secondary ms-2">Add</a>
                                        {% endif %}
                                    </li>
                                    <li class="list-group-item bg-card">
                                        <i class="fas {% if input_methods.brand_interview.used %}fa-check-circle{% else %}fa-times-circle text-muted{% endif %} me-2"></i>
                                        <span class="text-primary">Brand Interview</span>
                                        {% if input_methods.brand_interview.used %}
                                            <div>
                                                <span class="badge bg-success ms-2">Interview Complete</span>
                                                {% if input_methods.brand_interview.timestamp %}
                                                    <small class="text-muted d-block mt-1">{{ input_methods.brand_interview.timestamp }}</small>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <a href="{{ url_for('brand_interview') }}" class="badge bg-secondary ms-2">Add</a>
                                        {% endif %}
                                    </li>
                                    <li class="list-group-item bg-card">
                                        <i class="fas {% if input_methods.web_scraper.used %}fa-check-circle{% else %}fa-times-circle text-muted{% endif %} me-2"></i>
                                        <span class="text-primary">Web Scraper</span>
                                        {% if input_methods.web_scraper.used %}
                                            <div>
                                                <span class="badge bg-success ms-2">Web Analysis Complete</span>
                                                {% if input_methods.web_scraper.timestamp %}
                                                    <small class="text-muted d-block mt-1">{{ input_methods.web_scraper.timestamp }}</small>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <a href="{{ url_for('web_scraper_bp.index') }}" class="badge bg-secondary ms-2">Add</a>
                                        {% endif %}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8 mb-3">
                        <div class="info-card">
                            <div class="card-body">
                                <h5><i class="fas fa-file-export me-2"></i> Export & Integration Options</h5>
                                <p>Export your brand voice parameters for integration with copywriting systems.</p>
                                <div class="d-flex flex-wrap gap-2">
                                    <a href="{{ url_for('export', format='json') }}" class="btn btn-outline-primary">
                                        <i class="fas fa-download me-2"></i> Download JSON
                                    </a>
                                    <a href="{{ url_for('api_settings') }}" class="btn btn-outline-primary">
                                        <i class="fas fa-cogs me-2"></i> API Integration Settings
                                    </a>
                                    {% if api_settings.integration_enabled and api_settings.api_key %}
                                        <button id="sync-api-btn" class="btn btn-success">
                                            <i class="fas fa-sync me-2"></i> Sync with {{ api_settings.api_provider|capitalize }}
                                        </button>
                                    {% endif %}
                                </div>

                                {% if api_settings.integration_enabled and api_settings.api_key %}
                                    <div class="alert alert-success mt-3 mb-0">
                                        <i class="fas fa-check-circle me-2"></i> API Integration is enabled with {{ api_settings.api_provider|capitalize }}
                                        {% if api_settings.last_sync_time %}
                                            <br><small>Last synchronized: {{ api_settings.last_sync_time }}</small>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="alert alert-info mt-3 mb-0">
                                        <i class="fas fa-info-circle me-2"></i> Set up API integration to automatically send your brand voice parameters to external copywriting systems.
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <ul class="nav nav-tabs mb-4" id="parameterTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="personality-tab" data-bs-toggle="tab" data-bs-target="#personality" type="button" role="tab" aria-controls="personality" aria-selected="true">
                            <i class="fas fa-user-circle me-1"></i> Personality
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="emotional-tab" data-bs-toggle="tab" data-bs-target="#emotional" type="button" role="tab" aria-controls="emotional" aria-selected="false">
                            <i class="fas fa-heart me-1"></i> Emotional Tone
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="formality-tab" data-bs-toggle="tab" data-bs-target="#formality" type="button" role="tab" aria-controls="formality" aria-selected="false">
                            <i class="fas fa-balance-scale me-1"></i> Formality
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="vocabulary-tab" data-bs-toggle="tab" data-bs-target="#vocabulary" type="button" role="tab" aria-controls="vocabulary" aria-selected="false">
                            <i class="fas fa-book me-1"></i> Vocabulary
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="communication-tab" data-bs-toggle="tab" data-bs-target="#communication" type="button" role="tab" aria-controls="communication" aria-selected="false">
                            <i class="fas fa-comment me-1"></i> Communication
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="parameterTabsContent">
                    <!-- Personality Tab -->
                    <div class="tab-pane fade show active" id="personality" role="tabpanel" aria-labelledby="personality-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Brand Personality Profile</h4>
                                <div class="chart-container" style="position: relative; height:300px; background-color: var(--card-bg); border-radius: var(--border-radius-sm); padding: 10px;">
                                    <canvas id="personalityChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Personality Traits</h4>
                                <div class="mb-3">
                                    <h5 class="text-primary">Primary Traits</h5>
                                    <ul class="text-white">
                                        {% for trait in brand_parameters.personality.primary_traits %}
                                            <li>
                                                {{ trait|capitalize }}
                                                {% if parameter_sources and parameter_sources.personality.primary_traits %}
                                                    <small class="text-muted">
                                                        (Source:
                                                        {% for method in parameter_sources.personality.primary_traits %}
                                                            {% if loop.index > 1 %}, {% endif %}
                                                            {% if method == 'document_upload' %}
                                                                <i class="fas fa-file-alt" title="Document Upload"></i>
                                                            {% elif method == 'brand_interview' %}
                                                                <i class="fas fa-comments" title="Brand Interview"></i>
                                                            {% elif method == 'web_scraper' %}
                                                                <i class="fas fa-globe" title="Web Scraper"></i>
                                                            {% endif %}
                                                        {% endfor %}
                                                        )
                                                    </small>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="text-muted">No primary traits identified</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <h5 class="text-primary">Secondary Traits</h5>
                                    <ul class="text-white">
                                        {% for trait in brand_parameters.personality.secondary_traits %}
                                            <li>
                                                {{ trait|capitalize }}
                                                {% if parameter_sources and parameter_sources.personality.secondary_traits %}
                                                    <small class="text-muted">
                                                        (Source:
                                                        {% for method in parameter_sources.personality.secondary_traits %}
                                                            {% if loop.index > 1 %}, {% endif %}
                                                            {% if method == 'document_upload' %}
                                                                <i class="fas fa-file-alt" title="Document Upload"></i>
                                                            {% elif method == 'brand_interview' %}
                                                                <i class="fas fa-comments" title="Brand Interview"></i>
                                                            {% elif method == 'web_scraper' %}
                                                                <i class="fas fa-globe" title="Web Scraper"></i>
                                                            {% endif %}
                                                        {% endfor %}
                                                        )
                                                    </small>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="text-muted">No secondary traits identified</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="text-primary">Traits to Avoid</h5>
                                    <ul class="text-white">
                                        {% for trait in brand_parameters.personality.traits_to_avoid %}
                                            <li>{{ trait|capitalize }}</li>
                                        {% else %}
                                            <li class="text-muted">No traits to avoid identified</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Emotional Tone Tab -->
                    <div class="tab-pane fade" id="emotional" role="tabpanel" aria-labelledby="emotional-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Emotional Tone Profile</h4>
                                <div class="chart-container" style="position: relative; height:350px; background-color: var(--card-bg); border-radius: var(--border-radius-sm); padding: 15px;">
                                    <canvas id="emotionalChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Emotional Characteristics</h4>
                                <div class="mb-3">
                                    <h5>Primary Emotions</h5>
                                    <ul>
                                        {% for emotion in brand_parameters.emotional_tone.primary_emotions %}
                                            <li>
                                                {{ emotion|capitalize }}
                                                {% if parameter_sources and parameter_sources.emotional_tone.primary_emotions %}
                                                    <small class="text-muted">
                                                        (Source:
                                                        {% for method in parameter_sources.emotional_tone.primary_emotions %}
                                                            {% if loop.index > 1 %}, {% endif %}
                                                            {% if method == 'document_upload' %}
                                                                <i class="fas fa-file-alt" title="Document Upload"></i>
                                                            {% elif method == 'brand_interview' %}
                                                                <i class="fas fa-comments" title="Brand Interview"></i>
                                                            {% elif method == 'web_scraper' %}
                                                                <i class="fas fa-globe" title="Web Scraper"></i>
                                                            {% endif %}
                                                        {% endfor %}
                                                        )
                                                    </small>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="text-muted">No primary emotions identified</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <h5>Secondary Emotions</h5>
                                    <ul>
                                        {% for emotion in brand_parameters.emotional_tone.secondary_emotions %}
                                            <li>
                                                {{ emotion|capitalize }}
                                                {% if parameter_sources and parameter_sources.emotional_tone.secondary_emotions %}
                                                    <small class="text-muted">
                                                        (Source:
                                                        {% for method in parameter_sources.emotional_tone.secondary_emotions %}
                                                            {% if loop.index > 1 %}, {% endif %}
                                                            {% if method == 'document_upload' %}
                                                                <i class="fas fa-file-alt" title="Document Upload"></i>
                                                            {% elif method == 'brand_interview' %}
                                                                <i class="fas fa-comments" title="Brand Interview"></i>
                                                            {% elif method == 'web_scraper' %}
                                                                <i class="fas fa-globe" title="Web Scraper"></i>
                                                            {% endif %}
                                                        {% endfor %}
                                                        )
                                                    </small>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="text-muted">No secondary emotions identified</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <h5>Emotional Intensity</h5>
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar" role="progressbar" style="width: {{ brand_parameters.emotional_tone.intensity * 10 }}%;"
                                             aria-valuenow="{{ brand_parameters.emotional_tone.intensity }}" aria-valuemin="0" aria-valuemax="10">
                                            {{ brand_parameters.emotional_tone.intensity }}/10
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Subtle</small>
                                        <small class="text-muted">Moderate</small>
                                        <small class="text-muted">Intense</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Formality Tab -->
                    <div class="tab-pane fade" id="formality" role="tabpanel" aria-labelledby="formality-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Formality Level</h4>
                                <div class="chart-container" style="position: relative; height:300px; background-color: var(--card-bg); border-radius: var(--border-radius-sm); padding: 10px;">
                                    <canvas id="formalityChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Formality Characteristics</h4>
                                <div class="mb-3">
                                    <h5>Formality Score: {{ brand_parameters.formality.level }}/10</h5>
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar" role="progressbar" style="width: {{ brand_parameters.formality.level * 10 }}%;"
                                             aria-valuenow="{{ brand_parameters.formality.level }}" aria-valuemin="0" aria-valuemax="10">
                                            {{ brand_parameters.formality.level }}/10
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Very Casual</small>
                                        <small class="text-muted">Balanced</small>
                                        <small class="text-muted">Very Formal</small>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <h5>Context Variations</h5>
                                    {% if brand_parameters.formality.context_variations %}
                                        <p>{{ brand_parameters.formality.context_variations.get('general', 'No context variations specified.') }}</p>
                                    {% else %}
                                        <p class="text-muted">No context variations identified.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vocabulary Tab -->
                    <div class="tab-pane fade" id="vocabulary" role="tabpanel" aria-labelledby="vocabulary-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Preferred Terms</h4>
                                <div class="card">
                                    <div class="card-body">
                                        {% if brand_parameters.vocabulary.preferred_terms %}
                                            <div class="d-flex flex-wrap">
                                                {% for term in brand_parameters.vocabulary.preferred_terms %}
                                                    <span class="badge bg-secondary m-1">{{ term }}</span>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            <p class="text-muted">No preferred terms identified.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Vocabulary Characteristics</h4>
                                <div class="mb-3">
                                    <h5>Jargon Level</h5>
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ brand_parameters.vocabulary.jargon_level * 10 }}%;"
                                             aria-valuenow="{{ brand_parameters.vocabulary.jargon_level }}" aria-valuemin="0" aria-valuemax="10">
                                            {{ brand_parameters.vocabulary.jargon_level }}/10
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Minimal</small>
                                        <small class="text-muted">Moderate</small>
                                        <small class="text-muted">Extensive</small>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <h5>Technical Complexity</h5>
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ brand_parameters.vocabulary.technical_complexity * 10 }}%;"
                                             aria-valuenow="{{ brand_parameters.vocabulary.technical_complexity }}" aria-valuemin="0" aria-valuemax="10">
                                            {{ brand_parameters.vocabulary.technical_complexity }}/10
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Simple</small>
                                        <small class="text-muted">Moderate</small>
                                        <small class="text-muted">Complex</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communication Style Tab -->
                    <div class="tab-pane fade" id="communication" role="tabpanel" aria-labelledby="communication-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Communication Style Profile</h4>
                                <div class="chart-container" style="position: relative; height:300px; background-color: var(--card-bg); border-radius: var(--border-radius-sm); padding: 10px;">
                                    <canvas id="communicationChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4>Communication Characteristics</h4>
                                <div class="mb-3">
                                    <h5>Storytelling vs. Direct</h5>
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ brand_parameters.communication_style.storytelling_preference * 10 }}%;"
                                             aria-valuenow="{{ brand_parameters.communication_style.storytelling_preference }}" aria-valuemin="0" aria-valuemax="10">
                                            {{ brand_parameters.communication_style.storytelling_preference }}/10
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">Very Direct</small>
                                        <small class="text-muted">Balanced</small>
                                        <small class="text-muted">Narrative-focused</small>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <h5>Sentence Structure</h5>
                                    <p><strong>Length Preference:</strong> {{ brand_parameters.communication_style.sentence_structure.length_preference }}/10</p>
                                    <p><strong>Complexity Preference:</strong> {{ brand_parameters.communication_style.sentence_structure.complexity_preference }}/10</p>
                                </div>
                                <div class="mb-3">
                                    <h5>Rhetorical Devices</h5>
                                    {% if brand_parameters.communication_style.rhetorical_devices %}
                                        <ul>
                                            {% for device in brand_parameters.communication_style.rhetorical_devices %}
                                                <li>{{ device }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="text-muted">No rhetorical devices identified.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header card-header-feature">
                <h2 class="h4 mb-0"><i class="fas fa-file-alt me-2"></i> Brand Voice Summary</h2>
            </div>
            <div class="card-body">
                <p class="lead">Here's a comprehensive summary of your brand voice based on the analysis:</p>

                {% if not summary_approved %}
                <!-- Summary approval/edit form -->
                <form action="{{ url_for('approve_summary') }}" method="post" id="summaryForm">
                    <div class="alert alert-info mb-4">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-info-circle fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="alert-heading">Review and Approve</h5>
                                <p>Please review the brand voice summary below. You can approve it as is or edit it to better match your brand.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h5 class="text-primary">1. Brand Voice Description</h5>
                        <div class="form-group">
                            <textarea class="form-control bg-dark text-white" name="tone_description" rows="15" style="white-space: pre-wrap;">{{ brand_voice_summary.tone_description }}</textarea>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h5 class="text-primary">2. Key Brand Phrases</h5>
                        {% for phrase in brand_voice_summary.example_phrases %}
                            <div class="form-group mb-2">
                                <input type="text" class="form-control bg-dark text-white" name="example_phrases" value="{{ phrase }}">
                            </div>
                        {% endfor %}
                    </div>

                    <div class="mb-4">
                        <h5 class="text-primary">3. Words & Phrases We Use</h5>
                        <div class="form-group">
                            <div class="d-flex flex-wrap gap-2 mb-2">
                                {% for word in brand_voice_summary.frequently_used_words %}
                                    <div class="input-group" style="width: auto;">
                                        <input type="text" class="form-control bg-dark text-white" name="frequently_used_words" value="{{ word }}" style="width: 150px;">
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h5 class="text-primary">4. Words & Phrases We Avoid</h5>
                        <div class="form-group">
                            <div class="d-flex flex-wrap gap-2 mb-2">
                                {% for word in brand_voice_summary.words_to_avoid %}
                                    <div class="input-group" style="width: auto;">
                                        <input type="text" class="form-control bg-dark text-white" name="words_to_avoid" value="{{ word }}" style="width: 150px;">
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button type="submit" name="action" value="approve" class="btn btn-success">
                            <i class="fas fa-check me-2"></i> Approve As Is
                        </button>
                        <button type="submit" name="action" value="edit" class="btn btn-primary">
                            <i class="fas fa-edit me-2"></i> Save Edits
                        </button>
                    </div>
                </form>
                {% else %}
                <!-- Approved summary display -->
                <div class="mb-4">
                    <h5 class="text-primary">1. Brand Voice Description</h5>
                    <div class="card mb-3">
                        <div class="card-body">
                            <pre class="text-white" style="white-space: pre-wrap; background-color: transparent; border: none; font-family: inherit; font-size: inherit;">{{ brand_voice_summary.tone_description }}</pre>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5 class="text-primary">2. Key Brand Phrases</h5>
                    <div class="card mb-3">
                        <div class="card-body">
                            <ul class="mb-0">
                                {% for phrase in brand_voice_summary.example_phrases %}
                                    <li>{{ phrase }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5 class="text-primary">3. Words & Phrases We Use</h5>
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex flex-wrap gap-2">
                                {% for word in brand_voice_summary.frequently_used_words %}
                                    <span class="badge" style="background-color: #36d399; color: #1a1a1a; font-size: 14px; padding: 8px 12px; margin: 4px; font-weight: 500;">{{ word }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5 class="text-primary">4. Words & Phrases We Avoid</h5>
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex flex-wrap gap-2">
                                {% for word in brand_voice_summary.words_to_avoid %}
                                    <span class="badge bg-danger">{{ word }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Approved!</strong> This brand voice summary has been approved and is ready for use.
                </div>
                {% endif %}

                <div class="mt-3">
                    <small class="text-muted">{{ brand_voice_summary.source_info }}</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header card-header-feature">
                <h2 class="h4 mb-0"><i class="fas fa-bullhorn me-2"></i> Tone of Voice Prompt</h2>
            </div>
            <div class="card-body">
                <p class="lead">Use this comprehensive tone of voice prompt to guide copywriters in creating content that aligns with your brand voice:</p>

                <div class="card mb-4">
                    <div class="card-body">
                        <div class="p-3" style="white-space: pre-wrap; font-family: 'Inter', sans-serif; line-height: 1.6; color: #ffffff; font-weight: 400;">
                            {{ brand_voice_summary.tone_of_voice_prompt | safe }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header card-header-feature">
                <h2 class="h4 mb-0"><i class="fas fa-tags me-2"></i> Campaign Taglines</h2>
            </div>
            <div class="card-body">
                <p class="lead">Here are campaign taglines that exemplify your brand voice:</p>

                <div class="row">
                    {% for tagline in brand_voice_summary.campaign_taglines %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body d-flex align-items-center justify-content-center text-center p-4">
                                    <h3 class="display-6" style="font-weight: 600; color: #ffffff;">"{{ tagline }}"</h3>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header card-header-feature">
                <h2 class="h4 mb-0"><i class="fas fa-pen me-2"></i> Example Copy</h2>
            </div>
            <div class="card-body">
                <p class="lead">Based on your brand voice parameters, here's an example of copy that reflects your brand voice:</p>

                <div class="card mb-4">
                    <div class="card-body">
                        <blockquote class="blockquote">
                            <p>{{ example_copy | nl2br | safe }}</p>
                        </blockquote>
                    </div>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Note:</strong> This is a simplified example. For more nuanced and customized copy, you can use the exported parameters with a dedicated copywriting system.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Global Chart.js plugin to set dark background
        Chart.defaults.plugins.legend.labels.color = 'rgba(255, 255, 255, 0.9)';
        Chart.defaults.color = 'rgba(255, 255, 255, 0.9)';
        Chart.defaults.scale.grid.color = 'rgba(255, 255, 255, 0.1)';

        // Register a plugin that runs before each chart is drawn to ensure dark background
        Chart.register({
            id: 'darkBackground',
            beforeDraw: (chart) => {
                const ctx = chart.ctx;
                ctx.save();
                ctx.globalCompositeOperation = 'source-over';
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--card-bg');
                ctx.fillRect(0, 0, chart.width, chart.height);
                ctx.restore();
            }
        });

        // API Sync Button
        const syncApiBtn = document.getElementById('sync-api-btn');
        if (syncApiBtn) {
            syncApiBtn.addEventListener('click', function() {
                this.disabled = true;
                this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Synchronizing...';

                fetch('/api/sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        {% if csrf_token is defined %}
                        ,'X-CSRFToken': '{{ csrf_token() }}'
                        {% endif %}
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert('Synchronization failed: ' + data.error);
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-sync me-2"></i> Sync with {{ api_settings.api_provider|capitalize }}';
                    }
                })
                .catch(error => {
                    alert('Error: ' + error);
                    this.disabled = false;
                    this.innerHTML = '<i class="fas fa-sync me-2"></i> Sync with {{ api_settings.api_provider|capitalize }}';
                });
            });
        }

        // Personality Chart
        const personalityCtx = document.getElementById('personalityChart').getContext('2d');

        // Get the actual traits from the data
        const primaryTraits = [
            {% for trait in brand_parameters.personality.primary_traits %}
                '{{ trait|capitalize }}',
            {% endfor %}
        ];
        console.log('Primary traits:', primaryTraits);

        const secondaryTraits = [
            {% for trait in brand_parameters.personality.secondary_traits %}
                '{{ trait|capitalize }}',
            {% endfor %}
        ];
        console.log('Secondary traits:', secondaryTraits);

        // Combine all traits for labels
        let allTraits = [...new Set([...primaryTraits, ...secondaryTraits])];
        console.log('All traits:', allTraits);

        // Ensure we have at least some traits for the chart
        if (allTraits.length === 0) {
            allTraits = ['Innovative', 'Trustworthy', 'Friendly', 'Bold', 'Empathetic'];
            console.log('Using default traits:', allTraits);
        }

        const personalityChart = new Chart(personalityCtx, {
            type: 'radar',
            data: {
                labels: allTraits,
                datasets: [{
                    label: 'Personality Traits',
                    data: function() {
                        // Generate data array in JavaScript instead of Jinja2
                        return allTraits.map(trait => {
                            const isPrimary = primaryTraits.some(t => t.toLowerCase() === trait.toLowerCase());
                            const isSecondary = secondaryTraits.some(t => t.toLowerCase() === trait.toLowerCase());
                            return isPrimary ? 10 : (isSecondary ? 5 : 0);
                        });
                    }(),
                    backgroundColor: 'rgba(78, 121, 167, 0.2)',
                    borderColor: 'rgba(78, 121, 167, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(78, 121, 167, 1)'
                }]
            },
            options: {
                scales: {
                    r: {
                        angleLines: {
                            display: true,
                            color: 'rgba(196, 196, 196, 0.2)'
                        },
                        grid: {
                            color: 'rgba(196, 196, 196, 0.2)'
                        },
                        ticks: {
                            backdropColor: 'transparent',
                            color: 'rgba(196, 196, 196, 0.7)'
                        },
                        pointLabels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        },
                        suggestedMin: 0,
                        suggestedMax: 10
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Emotional Tone Chart
        const emotionalCtx = document.getElementById('emotionalChart').getContext('2d');

        // Get the actual emotions from the data
        const primaryEmotions = [
            {% for emotion in brand_parameters.emotional_tone.primary_emotions %}
                '{{ emotion|capitalize }}',
            {% endfor %}
        ];
        console.log('Primary emotions:', primaryEmotions);

        const secondaryEmotions = [
            {% for emotion in brand_parameters.emotional_tone.secondary_emotions %}
                '{{ emotion|capitalize }}',
            {% endfor %}
        ];
        console.log('Secondary emotions:', secondaryEmotions);

        // Combine all emotions for labels
        let allEmotions = [...new Set([...primaryEmotions, ...secondaryEmotions])];
        console.log('All emotions:', allEmotions);

        // Ensure we have at least some emotions for the chart
        if (allEmotions.length === 0) {
            allEmotions = ['Optimistic', 'Passionate', 'Calm', 'Reassuring'];
            console.log('Using default emotions:', allEmotions);
        }

        const emotionalChart = new Chart(emotionalCtx, {
            type: 'pie',
            data: {
                labels: allEmotions,
                datasets: [{
                    data: function() {
                        // Generate data array in JavaScript instead of Jinja2
                        return allEmotions.map(emotion => {
                            const isPrimary = primaryEmotions.some(e => e.toLowerCase() === emotion.toLowerCase());
                            const isSecondary = secondaryEmotions.some(e => e.toLowerCase() === emotion.toLowerCase());
                            return isPrimary ? 10 : (isSecondary ? 5 : 1);
                        });
                    }(),
                    backgroundColor: [
                        'rgba(78, 121, 167, 0.7)',   // Blue
                        'rgba(242, 142, 43, 0.7)',   // Orange
                        'rgba(225, 87, 89, 0.7)',    // Red
                        'rgba(118, 183, 178, 0.7)',  // Teal
                        'rgba(89, 161, 79, 0.7)',    // Green
                        'rgba(140, 85, 140, 0.7)',   // Purple
                        'rgba(127, 201, 127, 0.7)',  // Light Green
                        'rgba(190, 184, 220, 0.7)',  // Light Purple
                        'rgba(253, 180, 98, 0.7)',   // Light Orange
                        'rgba(255, 140, 140, 0.7)',  // Light Red
                        'rgba(30, 144, 255, 0.7)',   // Dodger Blue
                        'rgba(255, 215, 0, 0.7)'     // Gold
                    ].slice(0, allEmotions.length),
                    borderWidth: 1,
                    borderColor: [
                        'rgba(78, 121, 167, 1)',     // Blue
                        'rgba(242, 142, 43, 1)',     // Orange
                        'rgba(225, 87, 89, 1)',      // Red
                        'rgba(118, 183, 178, 1)',    // Teal
                        'rgba(89, 161, 79, 1)',      // Green
                        'rgba(140, 85, 140, 1)',     // Purple
                        'rgba(127, 201, 127, 1)',    // Light Green
                        'rgba(190, 184, 220, 1)',    // Light Purple
                        'rgba(253, 180, 98, 1)',     // Light Orange
                        'rgba(255, 140, 140, 1)',    // Light Red
                        'rgba(30, 144, 255, 1)',     // Dodger Blue
                        'rgba(255, 215, 0, 1)'       // Gold
                    ].slice(0, allEmotions.length)
                }]
            },
            options: {
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: 'rgba(255, 255, 255, 0.9)',
                            padding: 15,
                            font: {
                                size: 12
                            },
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                        titleColor: 'rgba(255, 255, 255, 1)',
                        bodyColor: 'rgba(255, 255, 255, 1)',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1
                    }
                }
            }
        });

        // Formality Chart
        const formalityCtx = document.getElementById('formalityChart').getContext('2d');
        const formalityChart = new Chart(formalityCtx, {
            type: 'gauge',
            data: {
                datasets: [{
                    value: {{ brand_parameters.formality.level }},
                    minValue: 1,
                    maxValue: 10,
                    backgroundColor: [
                        'rgba(78, 121, 167, 0.7)',  // Blue
                        'rgba(89, 161, 79, 0.7)',   // Green
                        'rgba(118, 183, 178, 0.7)', // Teal
                        'rgba(140, 85, 140, 0.7)',  // Purple
                        'rgba(242, 142, 43, 0.7)',  // Orange
                        'rgba(225, 87, 89, 0.7)',   // Red
                        'rgba(127, 201, 127, 0.7)', // Light Green
                        'rgba(190, 184, 220, 0.7)', // Light Purple
                        'rgba(253, 180, 98, 0.7)',  // Light Orange
                        'rgba(255, 140, 140, 0.7)'  // Light Red
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                needle: {
                    radiusPercentage: 2,
                    widthPercentage: 3.2,
                    lengthPercentage: 80,
                    color: 'rgba(196, 196, 196, 1)'
                },
                valueLabel: {
                    display: true,
                    formatter: function(value) {
                        return value + '/10';
                    },
                    color: 'rgba(255, 255, 255, 1)',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    borderRadius: 5,
                    padding: {
                        top: 10,
                        bottom: 10
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                },
                backgroundColor: 'rgba(30, 30, 30, 1)'
            }
        });

        // Communication Style Chart
        const communicationCtx = document.getElementById('communicationChart').getContext('2d');
        const communicationChart = new Chart(communicationCtx, {
            type: 'bar',
            data: {
                labels: ['Storytelling', 'Sentence Length', 'Sentence Complexity'],
                datasets: [{
                    label: 'Communication Style',
                    data: [
                        {{ brand_parameters.communication_style.storytelling_preference }},
                        {{ brand_parameters.communication_style.sentence_structure.length_preference }},
                        {{ brand_parameters.communication_style.sentence_structure.complexity_preference }}
                    ],
                    backgroundColor: [
                        'rgba(78, 121, 167, 0.7)',  // Blue
                        'rgba(242, 142, 43, 0.7)',  // Orange
                        'rgba(225, 87, 89, 0.7)'    // Red
                    ],
                    borderColor: [
                        'rgba(78, 121, 167, 1)',    // Blue
                        'rgba(242, 142, 43, 1)',    // Orange
                        'rgba(225, 87, 89, 1)'      // Red
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        grid: {
                            color: 'rgba(196, 196, 196, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(196, 196, 196, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
